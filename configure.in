dnl
dnl  $Id$
dnl

AC_PREREQ(2.50)
AC_INIT()

AM_INIT_AUTOMAKE(bluez-utils, 2.6)
AM_CONFIG_HEADER(config.h)

AM_MAINTAINER_MODE

AC_PREFIX_DEFAULT(/usr)

if test "$prefix" = "NONE"; then
	dnl no prefix and no sysconfdir, so default to /etc
	if test "$sysconfdir" = '${prefix}/etc'; then
		AC_SUBST([sysconfdir], ['/etc'])
	fi

	dnl no prefix and no mandir, so use ${prefix}/share/man as default
	if test "$mandir" = '${prefix}/man'; then
		AC_SUBST([mandir], ['${prefix}/share/man'])
	fi
fi

CFLAGS="-Wall -g -O2"

AC_LANG_C

AC_PROG_CC
AC_PROG_INSTALL
AC_PROG_YACC
AM_PROG_LEX

AC_ARG_WITH(bluez, [  --with-bluez=DIR        BlueZ library is installed in DIR], [
	bluez_includes=$withval/include
	bluez_libraries=$withval/lib
])

AC_PATH_BLUEZ

AC_ARG_ENABLE(dbus, [  --enable-dbus           use D-BUS],
	BLUEZ_DBUS="$enableval",
	BLUEZ_DBUS="no"
)

if test x"$BLUEZ_DBUS" == "xyes"; then
	PKG_CHECK_MODULES(DBUS, dbus-1, have_dbus=yes, have_dbus=no)

	CFLAGS="$CFLAGS $DBUS_CFLAGS -DENABLE_DBUS"
	LIBS="$LIBS $DBUS_LIBS"
fi

AM_CONDITIONAL(ENABLE_DBUS, test x$BLUEZ_DBUS = xyes)

AC_OUTPUT(Makefile hcid/Makefile tools/Makefile rfcomm/Makefile sdpd/Makefile test/Makefile scripts/Makefile pcmcia/Makefile)
